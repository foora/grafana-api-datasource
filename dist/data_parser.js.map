{"version":3,"sources":["data_parser.js"],"names":["Parser","ConfigStr","options","JSON","parse","err","res","data","format","parseTableData","parseSeriesData","Array","length","columns","result","type","rows","j","clen","key","label","push","text","i","len","item","lines","timeKey","line","temp","target","datapoints","forEach"],"mappings":";;;;;;;;;;;;;IAAaA,M;;;;;;;qCACQC,S,EAAW;AACxB,UAAIC,OAAJ;;AACA,UAAI;AACAA,QAAAA,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWH,SAAX,CAAV;AACH,OAFD,CAEE,OAAOI,GAAP,EAAY;AACVH,QAAAA,OAAO,GAAG,EAAV;AACH;;AACD,aAAOA,OAAP;AACH;;;uCACkBI,G,EAAKJ,O,EAAS;AAC7B,UAAI,CAACI,GAAG,CAACC,IAAT,EAAe;AACX,eAAO;AAAEA,UAAAA,IAAI,EAAE;AAAR,SAAP;AACH;;AAED,UAAIC,MAAM,GAAGN,OAAO,CAACM,MAArB;;AAEA,UAAIA,MAAM,KAAK,OAAf,EAAwB;AACpB,eAAO,KAAKC,cAAL,CAAoBH,GAAG,CAACC,IAAxB,EAA8BL,OAA9B,CAAP;AACH,OAFD,MAEO,IAAIM,MAAM,KAAK,QAAf,EAAyB;AAC5B,eAAO,KAAKE,eAAL,CAAqBJ,GAAG,CAACC,IAAzB,EAA+BL,OAA/B,CAAP;AACH,OAFM,MAEA;AACH,eAAO;AAAEK,UAAAA,IAAI,EAAE;AAAR,SAAP;AACH;AACJ;;;mCAEcA,I,EAAML,O,EAAS;AAC1B,UAAI,EAAEK,IAAI,YAAYI,KAAlB,KAA4BJ,IAAI,CAACK,MAAL,KAAgB,CAAhD,EAAmD;AAC/C,eAAO;AAAEL,UAAAA,IAAI,EAAE;AAAR,SAAP;AACH;;AACD,UAAIM,OAAO,GAAGX,OAAO,CAACW,OAAtB;;AACA,UAAI,EAAEA,OAAO,YAAYF,KAArB,KAA+BE,OAAO,CAACD,MAAR,KAAmB,CAAtD,EAAyD;AACrD,eAAO;AAAEL,UAAAA,IAAI,EAAE;AAAR,SAAP;AACH;;AACD,UAAIO,MAAM,GAAG;AACTC,QAAAA,IAAI,EAAE,OADG;AAETF,QAAAA,OAAO,EAAE,EAFA;AAGTG,QAAAA,IAAI,EAAE;AAHG,OAAb;;AAKA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAGL,OAAO,CAACD,MAA/B,EAAuCK,CAAC,GAAGC,IAA3C,EAAiDD,CAAC,EAAlD,EAAsD;AAClD,YAAIE,GAAG,GAAGN,OAAO,CAACI,CAAD,CAAP,CAAWE,GAArB;AACA,YAAIC,KAAK,GAAGP,OAAO,CAACI,CAAD,CAAP,CAAWG,KAAvB;AACAN,QAAAA,MAAM,CAACD,OAAP,CAAeQ,IAAf,CAAoB;AAAEC,UAAAA,IAAI,EAAEF;AAAR,SAApB;;AACA,aAAK,IAAIG,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGjB,IAAI,CAACK,MAA3B,EAAmCW,CAAC,GAAGC,GAAvC,EAA4CD,CAAC,EAA7C,EAAiD;AAC7C,cAAI,CAACT,MAAM,CAACE,IAAP,CAAYO,CAAZ,CAAL,EAAqBT,MAAM,CAACE,IAAP,CAAYO,CAAZ,IAAiB,EAAjB;AACrB,cAAIE,IAAI,GAAGlB,IAAI,CAACgB,CAAD,CAAf;AACAT,UAAAA,MAAM,CAACE,IAAP,CAAYO,CAAZ,EAAeF,IAAf,CAAoBI,IAAI,CAACN,GAAD,CAAxB;AACH;AACJ;;AACD,aAAO;AAAEZ,QAAAA,IAAI,EAAE,CAACO,MAAD;AAAR,OAAP;AACH;;;oCACeP,I,EAAML,O,EAAS;AAC3B,UAAI,EAAEK,IAAI,YAAYI,KAAlB,KAA4BJ,IAAI,CAACK,MAAL,KAAgB,CAAhD,EAAmD;AAC/C,eAAO;AAAEL,UAAAA,IAAI,EAAE;AAAR,SAAP;AACH;;AACD,UAAImB,KAAK,GAAGxB,OAAO,CAACwB,KAApB;;AACA,UAAI,CAACA,KAAD,IAAU,CAACA,KAAK,CAACC,OAAjB,IAA4B,EAAED,KAAK,CAACE,IAAN,YAAsBjB,KAAxB,CAA5B,IAA8De,KAAK,CAACE,IAAN,CAAWhB,MAAX,KAAsB,CAAxF,EAA2F;AACvF,eAAO;AAAEL,UAAAA,IAAI,EAAE;AAAR,SAAP;AACH;;AACD,UAAIoB,OAAO,GAAGD,KAAK,CAACC,OAApB;AACA,UAAIb,MAAM,GAAG,EAAb;;AAT2B,iCAUlBS,CAVkB,EAUXC,GAVW;AAWvB,YAAIK,IAAI,GAAG;AACPC,UAAAA,MAAM,EAAEJ,KAAK,CAACE,IAAN,CAAWL,CAAX,EAAcH,KADf;AAEPW,UAAAA,UAAU,EAAE;AAFL,SAAX;AAIA,YAAIZ,GAAG,GAAGO,KAAK,CAACE,IAAN,CAAWL,CAAX,EAAcJ,GAAxB;AACAZ,QAAAA,IAAI,CAACyB,OAAL,CAAa,UAACP,IAAD;AAAA,iBAAUI,IAAI,CAACE,UAAL,CAAgBV,IAAhB,CAAqB,CAACI,IAAI,CAACN,GAAD,CAAL,EAAYM,IAAI,CAACE,OAAD,CAAhB,CAArB,CAAV;AAAA,SAAb;AACAb,QAAAA,MAAM,CAACO,IAAP,CAAYQ,IAAZ;AAjBuB;;AAU3B,WAAK,IAAIN,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,KAAK,CAACE,IAAN,CAAWhB,MAAjC,EAAyCW,CAAC,GAAGC,GAA7C,EAAkDD,CAAC,EAAnD,EAAuD;AAAA,cAA9CA,CAA8C,EAAvCC,GAAuC;AAQtD;;AACD,aAAO;AAAEjB,QAAAA,IAAI,EAAEO;AAAR,OAAP;AACH","sourcesContent":["export class Parser {\n    parseQueryConfig(ConfigStr) {\n        let options;\n        try {\n            options = JSON.parse(ConfigStr);\n        } catch (err) {\n            options = {};\n        }\n        return options;\n    }\n    parseQueryResponse(res, options) {\n        if (!res.data) {\n            return { data: [] };\n        }\n\n        let format = options.format;\n\n        if (format === 'table') {\n            return this.parseTableData(res.data, options);\n        } else if (format === 'series') {\n            return this.parseSeriesData(res.data, options);\n        } else {\n            return { data: [] };\n        }\n    }\n\n    parseTableData(data, options) {\n        if (!(data instanceof Array) || data.length === 0) {\n            return { data: [] };\n        }\n        let columns = options.columns;\n        if (!(columns instanceof Array) || columns.length === 0) {\n            return { data: [] };\n        }\n        let result = {\n            type: 'table',\n            columns: [],\n            rows: []\n        };\n        for (let j = 0, clen = columns.length; j < clen; j++) {\n            let key = columns[j].key;\n            let label = columns[j].label;\n            result.columns.push({ text: label });\n            for (let i = 0, len = data.length; i < len; i++) {\n                if (!result.rows[i]) result.rows[i] = [];\n                let item = data[i];\n                result.rows[i].push(item[key]);\n            }\n        }\n        return { data: [result] };\n    }\n    parseSeriesData(data, options) {\n        if (!(data instanceof Array) || data.length === 0) {\n            return { data: [] };\n        }\n        let lines = options.lines;\n        if (!lines || !lines.timeKey || !(lines.line instanceof Array) || lines.line.length === 0) {\n            return { data: [] };\n        }\n        let timeKey = lines.timeKey;\n        let result = [];\n        for (let i = 0, len = lines.line.length; i < len; i++) {\n            let temp = {\n                target: lines.line[i].label,\n                datapoints: []\n            };\n            let key = lines.line[i].key;\n            data.forEach((item) => temp.datapoints.push([item[key], item[timeKey]]));\n            result.push(temp);\n        }\n        return { data: result };\n    }\n}"],"file":"data_parser.js"}