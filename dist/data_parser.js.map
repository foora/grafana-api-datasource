{"version":3,"sources":["data_parser.js"],"names":["Parser","parseQueryConfig","ConfigStr","options","JSON","parse","err","parseQueryResponse","res","data","format","parseTableData","parseSeriesData","Array","length","columns","result","type","rows","j","clen","key","label","push","text","i","len","item","lines","timeKey","line","temp","target","datapoints","forEach"],"mappings":"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","sourcesContent":["export class Parser {\n    parseQueryConfig(ConfigStr) {\n        let options;\n        try {\n            options = JSON.parse(ConfigStr);\n        } catch (err) {\n            options = {};\n        }\n        return options;\n    }\n    parseQueryResponse(res, options) {\n        if (!res.data) {\n            return { data: [] };\n        }\n\n        let format = options.format;\n\n        if (format === 'table') {\n            return this.parseTableData(res.data, options);\n        } else if (format === 'series') {\n            return this.parseSeriesData(res.data, options);\n        } else {\n            return { data: [] };\n        }\n    }\n\n    parseTableData(data, options) {\n        if (!(data instanceof Array) || data.length === 0) {\n            return { data: [] };\n        }\n        let columns = options.columns;\n        if (!(columns instanceof Array) || columns.length === 0) {\n            return { data: [] };\n        }\n        let result = {\n            type: 'table',\n            columns: [],\n            rows: []\n        };\n        for (let j = 0, clen = columns.length; j < clen; j++) {\n            let key = columns[j].key;\n            let label = columns[j].label;\n            result.columns.push({ text: label });\n            for (let i = 0, len = data.length; i < len; i++) {\n                if (!result.rows[i]) result.rows[i] = [];\n                let item = data[i];\n                result.rows[i].push(item[key]);\n            }\n        }\n        return { data: [result] };\n    }\n    parseSeriesData(data, options) {\n        if (!(data instanceof Array) || data.length === 0) {\n            return { data: [] };\n        }\n        let lines = options.lines;\n        if (!lines || !lines.timeKey || !(lines.line instanceof Array) || lines.line.length === 0) {\n            return { data: [] };\n        }\n        let timeKey = lines.timeKey;\n        let result = [];\n        for (let i = 0, len = lines.line.length; i < len; i++) {\n            let temp = {\n                target: lines.line[i].label,\n                datapoints: []\n            };\n            let key = lines.line[i].key;\n            data.forEach((item) => temp.datapoints.push([item[key], item[timeKey]]));\n            result.push(temp);\n        }\n        return { data: result };\n    }\n}"],"file":"data_parser.js"}